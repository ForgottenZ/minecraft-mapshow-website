# Minecraft 地图展示网站

一个简洁的 Minecraft 地图展示与下载站点，基于 Flask + SQLite。游客只能浏览，登录后才能下载；管理员可管理用户、标签与下载记录。

## 功能概览

- **游客浏览**：未登录用户视为游客，仅能查看地图与标签。
- **登录下载**：登录后提供下载按钮；下载接口带鉴权并记录下载记录。
- **角色区分**：游客 / 普通用户 / 管理员。
- **管理员权限**：
  - 管理用户（启用/禁用、设为管理员、删除，至少保留一个管理员）。
  - 管理标签（创建、删除、设为默认）。
  - 地图打标签（支持默认标签快捷按钮）。
  - 查看用户登录时间与下载记录。
- **首次启动初始化**：系统检测无管理员时，要求创建管理员账号。
- **地图检测规则**：检查运行目录下的 `mcmap` 文件夹，要求：
  - 地图文件夹：`mcmap/<地图名>/`
  - 同名压缩包可放在 `mcmap/<地图名>.zip` 或 `mcmap/<地图名>/<地图名>.zip`（目录内任意 `.zip` 也可）。
  - Windows 生成的 `*.url` 文件可放在 `mcmap/` 或对应地图目录内，系统会尝试匹配与地图名相同或前缀相同的 `.url` 文件，并解析其中的 `URL=` 作为“详细说明”按钮链接。

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 准备地图数据

```text
mcmap/
  MyMap/
  MyMap.zip
  MyMap.url
```

> `.url` 示例：
> ```
> [InternetShortcut]
> URL=https://example.com
> ```

如果你的地图目录挂载在其他路径，请在配置文件中调整 `mcmap_dir`（建议使用 Linux 绝对路径）。

### 3. 启动服务

```bash
python app.py
```

首次访问会跳转到管理员创建页面，创建管理员后即可登录并进行管理。

## 管理说明

- **用户管理**：管理员可在“用户管理”页面禁用/启用账户，并调整角色。
- **标签管理**：管理员可在“标签管理”页面创建标签或设为默认。
- **地图标签**：在地图详情页点击“管理标签”，可直接勾选标签；
  - 默认标签会以快捷按钮形式展示；
-  - 页面内支持填写地图简介与快速创建标签。
- **下载记录**：在“下载记录”页面查看所有用户的下载时间与地图名称。
- **注册设置**：管理员可在仪表盘关闭注册或切换为邮箱验证注册。
- **地图扫描**：系统每分钟自动扫描一次地图目录，管理员可在仪表盘手动触发。

## 配置文件

项目根目录的 `config.json` 维护地图目录、密钥与邮件配置。首次启动会自动生成默认配置。

```json
{
  "secret_key": "dev-secret-key",
  "debug": false,
  "mcmap_dir": "/mcmap",
  "smtp": {
    "host": "smtp.example.com",
    "port": 587,
    "user": "your_account",
    "password": "your_password",
    "from": "your_account",
    "use_tls": true
  }
}
```

## 邮箱注册配置

当管理员切换为“邮箱验证”注册方式时，需要在 `config.json` 中配置 SMTP 信息。

## 调试工具

当 `config.json` 的 `debug` 设为 `true` 时，管理员仪表盘会显示“调试工具”入口，用于查看程序当前能访问到的配置、缓存与目录信息。

## 数据与权限

- SQLite 数据库文件位于项目根目录 `app.db`。
- 所有下载均在后台记录，管理员可查询。
- 普通用户仅有下载权限；管理员拥有所有管理权限。

## 常见问题

**Q: 没有地图显示？**

请确认 `mcmap` 目录存在，并且每个地图具备同名压缩包。

**Q: “详细说明”按钮不显示？**

需要在 `mcmap` 根目录放置 `.url` 文件，并且文件名与地图名相同或以地图名开头。
