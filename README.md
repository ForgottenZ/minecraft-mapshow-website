# Minecraft 地图展示网站

一个简洁的 Minecraft 地图展示与下载站点，基于 Flask + SQLite。游客只能浏览，登录后才能下载；管理员可管理用户、标签与下载记录。

## 功能概览

- **游客浏览**：未登录用户视为游客，仅能查看地图与标签。
- **登录下载**：登录后提供下载按钮；下载接口带鉴权并记录下载记录。
- **角色区分**：游客 / 普通用户 / 管理员。
- **管理员权限**：
  - 管理用户（启用/禁用、设为管理员、删除，至少保留一个管理员）。
  - 管理标签（创建、删除、设为默认）。
  - 地图打标签（支持默认标签快捷按钮）。
  - 查看用户登录时间与下载记录。
- **首次启动初始化**：系统检测无管理员时，要求创建管理员账号。
- **地图检测规则**：检查运行目录下的 `mcmap` 文件夹，要求：
  - 地图文件夹：`mcmap/<地图名>/`
  - 同名压缩包：`mcmap/<地图名>.zip`
  - Windows 生成的 `*.url` 文件（名称可任意）。系统会尝试匹配与地图名相同或前缀相同的 `.url` 文件，并解析其中的 `URL=`，作为“详细说明”按钮链接。

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 准备地图数据

```text
mcmap/
  MyMap/
  MyMap.zip
  MyMap.url
```

> `.url` 示例：
> ```
> [InternetShortcut]
> URL=https://example.com
> ```

### 3. 启动服务

```bash
python app.py
```

首次访问会跳转到管理员创建页面，创建管理员后即可登录并进行管理。

## 管理说明

- **用户管理**：管理员可在“用户管理”页面禁用/启用账户，并调整角色。
- **标签管理**：管理员可在“标签管理”页面创建标签或设为默认。
- **地图标签**：在地图详情页点击“管理标签”，可直接勾选标签；
  - 默认标签会以快捷按钮形式展示；
  - 页面内含可拖动的 iframe 用于快速创建新标签。
- **下载记录**：在“下载记录”页面查看所有用户的下载时间与地图名称。

## 数据与权限

- SQLite 数据库文件位于项目根目录 `app.db`。
- 所有下载均在后台记录，管理员可查询。
- 普通用户仅有下载权限；管理员拥有所有管理权限。

## 常见问题

**Q: 没有地图显示？**

请确认 `mcmap` 目录存在，并且每个地图具备同名压缩包。

**Q: “详细说明”按钮不显示？**

需要在 `mcmap` 根目录放置 `.url` 文件，并且文件名与地图名相同或以地图名开头。
