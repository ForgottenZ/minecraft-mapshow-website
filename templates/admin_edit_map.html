{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>地图标签管理：{{ map_name }}</h2>
  <form method="post" class="tag-form">
    <input type="hidden" name="action" value="update" />
    <label>
      地图简介
      <textarea name="description" rows="4" placeholder="填写地图简介">{{ description }}</textarea>
    </label>
    <div class="tag-actions">
      <button type="submit" class="button primary">保存标签与简介</button>
    </div>
    <div class="default-tags">
      <span class="hint">默认标签快捷按钮：</span>
      {% for tag in default_tags %}
        <button type="button" class="button small" data-tag="{{ tag.id }}">{{ tag.name }}</button>
      {% else %}
        <span class="hint">暂无默认标签</span>
      {% endfor %}
    </div>
    <div class="checkbox-grid">
      {% for tag in tags %}
        <label class="checkbox">
          <input type="checkbox" name="tags" value="{{ tag.id }}" {% if tag.id in current_ids %}checked{% endif %} />
          {{ tag.name }}
        </label>
      {% endfor %}
    </div>
  </form>
</section>

<section class="card">
  <h3>创建新标签</h3>
  <form method="post" class="form-grid">
    <input type="hidden" name="action" value="create_tag" />
    <label>
      标签名称
      <input type="text" name="new_tag_name" />
    </label>
    <label class="checkbox">
      <input type="checkbox" name="new_tag_default" />
      设为默认标签
    </label>
    <button type="submit" class="button">创建标签</button>
  </form>
</section>

<script>
  const defaultButtons = document.querySelectorAll('[data-tag]');
  defaultButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const tagId = button.getAttribute('data-tag');
      const checkbox = document.querySelector(`input[name="tags"][value="${tagId}"]`);
      if (checkbox) {
        checkbox.checked = !checkbox.checked;
      }
    });
  });
</script>
{% endblock %}
