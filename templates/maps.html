{% extends "base.html" %}
{% block content %}
<section>
  <h2>åœ°å›¾åˆ—è¡¨</h2>
  <form method="get" class="search-bar card">
    <label>
      æœç´¢
      <input type="text" name="q" value="{{ query }}" placeholder="è¾“å…¥å…³é”®å­—" />
    </label>
    <label>
      æœç´¢èŒƒå›´
      <select name="field">
        <option value="all" {% if field == "all" %}selected{% endif %}>å…¨éƒ¨</option>
        <option value="title" {% if field == "title" %}selected{% endif %}>æ ‡é¢˜</option>
        <option value="tag" {% if field == "tag" %}selected{% endif %}>æ ‡ç­¾</option>
        <option value="content" {% if field == "content" %}selected{% endif %}>å†…å®¹</option>
      </select>
    </label>
    <label>
      æ¯é¡µæ•°é‡
      <select name="per_page">
        <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
        <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
        <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
      </select>
    </label>
    <button type="submit" class="primary">æŸ¥è¯¢</button>
  </form>
  {% if maps %}
    <div class="map-grid">
      {% for item in maps %}
        <div class="card map-card">
          <div class="map-card-header">
            <h3>{{ item.display_name }}</h3>
            {% if item.version %}
              <span class="badge version-badge">ğŸ® {{ item.version }}</span>
            {% endif %}
          </div>
          {% if item.description %}
            <p class="map-summary">{{ item.description }}</p>
          {% else %}
            <p class="map-summary muted">æš‚æ— åœ°å›¾ç®€ä»‹ã€‚</p>
          {% endif %}
          <div class="tag-list map-tags">
            {% for tag in item.tags %}
              <span class="tag" {% if tag.color %}style="background: {{ tag.color }}; color: #fff;"{% endif %}>ğŸ·ï¸ {{ tag.name }}</span>
            {% else %}
              <span class="tag muted">æš‚æ— æ ‡ç­¾</span>
            {% endfor %}
          </div>
          <div class="map-actions">
            <a class="button" href="{{ url_for('map_detail', map_name=item.name) }}">æŸ¥çœ‹è¯¦æƒ…</a>
            {% if user %}
              <a class="button primary" href="{{ url_for('download', map_name=item.name) }}">ä¸‹è½½</a>
            {% else %}
              <span class="button disabled" title="ç™»å½•åå¯ä¸‹è½½">ç™»å½•åä¸‹è½½</span>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
    {% if total_pages > 1 %}
      <div class="pagination">
        {% if page > 1 %}
          <a class="button" href="{{ url_for('index', q=query, field=field, per_page=per_page, page=page-1) }}">ä¸Šä¸€é¡µ</a>
        {% endif %}
        {% for p in pages %}
          {% if p == page %}
            <span class="button primary">{{ p }}</span>
          {% else %}
            <a class="button" href="{{ url_for('index', q=query, field=field, per_page=per_page, page=p) }}">{{ p }}</a>
          {% endif %}
        {% endfor %}
        {% if page < total_pages %}
          <a class="button" href="{{ url_for('index', q=query, field=field, per_page=per_page, page=page+1) }}">ä¸‹ä¸€é¡µ</a>
        {% endif %}
      </div>
    {% endif %}
  {% else %}
    <div class="card">
      {% if query %}
        <p>æ²¡æœ‰åŒ¹é…çš„åœ°å›¾ï¼Œè¯·å°è¯•è°ƒæ•´å…³é”®å­—æˆ–æœç´¢èŒƒå›´ã€‚</p>
      {% else %}
        <p>æœªæ£€æµ‹åˆ°å¯ç”¨åœ°å›¾ã€‚è¯·åœ¨è¿è¡Œç›®å½•åˆ›å»º <code>mcmap</code> æ–‡ä»¶å¤¹ï¼Œå¹¶æ”¾å…¥åœ°å›¾æ–‡ä»¶å¤¹ä¸åŒåå‹ç¼©åŒ…ã€‚</p>
      {% endif %}
    </div>
  {% endif %}
</section>
{% endblock %}
