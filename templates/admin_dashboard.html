{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>管理员仪表盘</h2>
  <div class="stats">
    <div class="stat">
      <span class="stat-value">{{ user_count }}</span>
      <span class="stat-label">用户数量</span>
    </div>
    <div class="stat">
      <span class="stat-value">{{ download_count }}</span>
      <span class="stat-label">下载记录</span>
    </div>
    <div class="stat">
      <span class="stat-value">{{ tag_count }}</span>
      <span class="stat-label">标签数量</span>
    </div>
  </div>
  <div class="admin-links">
    <a class="button" href="{{ url_for('admin_users') }}">用户管理</a>
    <a class="button" href="{{ url_for('admin_tags') }}">标签管理</a>
    <a class="button" href="{{ url_for('admin_downloads') }}">下载记录</a>
    {% if debug_enabled %}
      <a class="button" href="{{ url_for('admin_debug') }}">调试工具</a>
    {% endif %}
  </div>
</section>
<section class="card">
  <h3>注册设置</h3>
  <form method="post" action="{{ url_for('admin_settings') }}" class="form-grid">
    <label class="checkbox">
      <input type="checkbox" name="registration_enabled" {% if registration_enabled %}checked{% endif %} />
      允许注册
    </label>
    <label>
      注册方式
      <select name="registration_mode">
        <option value="none" {% if registration_mode == "none" %}selected{% endif %}>无需邮箱</option>
        <option value="email" {% if registration_mode == "email" %}selected{% endif %}>邮箱验证</option>
      </select>
    </label>
    <p class="hint">
      邮箱验证需要在配置文件中填写 SMTP 信息后生效。
    </p>
    <button type="submit" class="primary">保存设置</button>
  </form>
</section>
<section class="card">
  <h3>地图扫描</h3>
  <p class="hint">
    系统每分钟自动扫描一次地图目录。
    {% if last_scan_at %}
      最近扫描时间：{{ last_scan_at }} (UTC)
    {% else %}
      尚未扫描。
    {% endif %}
  </p>
  <form method="post" action="{{ url_for('admin_scan_maps') }}">
    <button type="submit" class="primary">立即扫描</button>
  </form>
</section>
{% endblock %}
