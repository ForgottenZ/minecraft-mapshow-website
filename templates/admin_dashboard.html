{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>管理员仪表盘</h2>
  <div class="stats">
    <div class="stat">
      <span class="stat-value">{{ user_count }}</span>
      <span class="stat-label">用户数量</span>
    </div>
    <div class="stat">
      <span class="stat-value">{{ download_count }}</span>
      <span class="stat-label">下载记录</span>
    </div>
    <div class="stat">
      <span class="stat-value">{{ tag_count }}</span>
      <span class="stat-label">标签数量</span>
    </div>
  </div>
  <div class="admin-links">
    <a class="button" href="{{ url_for('admin_users') }}">用户管理</a>
    <a class="button" href="{{ url_for('admin_tags') }}">标签管理</a>
    <a class="button" href="{{ url_for('admin_downloads') }}">下载记录</a>
    {% if debug_enabled %}
      <a class="button" href="{{ url_for('admin_debug') }}">调试工具</a>
    {% endif %}
  </div>
</section>
<section class="card">
  <h3>注册设置</h3>
  <form method="post" action="{{ url_for('admin_settings') }}" class="form-grid">
    <label class="checkbox">
      <input type="checkbox" name="registration_enabled" {% if registration_enabled %}checked{% endif %} />
      允许注册
    </label>
    <label>
      注册方式
      <select name="registration_mode">
        <option value="none" {% if registration_mode == "none" %}selected{% endif %}>无需邮箱</option>
        <option value="email" {% if registration_mode == "email" %}selected{% endif %}>邮箱验证</option>
      </select>
    </label>
    <label class="checkbox">
      <input type="checkbox" name="registration_default_enabled" {% if registration_default_enabled %}checked{% endif %} />
      注册默认启用
    </label>
    <label>
      邮箱后缀策略
      <select name="email_domain_policy">
        <option value="none" {% if email_domain_policy == "none" %}selected{% endif %}>不限制</option>
        <option value="whitelist" {% if email_domain_policy == "whitelist" %}selected{% endif %}>白名单</option>
        <option value="blacklist" {% if email_domain_policy == "blacklist" %}selected{% endif %}>黑名单</option>
      </select>
    </label>
    <label>
      邮箱后缀列表
      <input type="text" name="email_domain_list" value="{{ email_domain_list }}" placeholder="qq.com,gmail.com" />
    </label>
    <p class="hint">
      邮箱验证需要在配置文件中填写 SMTP 信息后生效。后缀列表支持用逗号或空格分隔。
    </p>
    <button type="submit" class="primary">保存设置</button>
  </form>
</section>
<section class="card">
  <h3>站点显示</h3>
  <form method="post" action="{{ url_for('admin_site_settings') }}" class="form-grid">
    <label>
      标题
      <input type="text" name="site_title" value="{{ site_title }}" />
    </label>
    <label>
      副标题
      <input type="text" name="site_subtitle" value="{{ site_subtitle }}" />
    </label>
    <label>
      网站图标路径
      <input type="text" name="site_icon_path" value="{{ site_icon_path }}" placeholder="/absolute/path/favicon.png" />
    </label>
    <p class="hint">
      网站图标需填写服务器上的绝对路径，留空则不显示图标。
    </p>
    <button type="submit" class="primary">保存显示设置</button>
  </form>
</section>
<section class="card">
  <h3>地图扫描</h3>
  <p class="hint">
    系统每分钟自动扫描一次地图目录。
    {% if last_scan_at %}
      最近扫描时间：{{ last_scan_at }} (UTC)
    {% else %}
      尚未扫描。
    {% endif %}
  </p>
  <form method="post" action="{{ url_for('admin_scan_maps') }}">
    <button type="submit" class="primary">立即扫描</button>
  </form>
</section>
{% endblock %}
